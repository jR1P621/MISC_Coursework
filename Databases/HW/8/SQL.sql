-- CATEGORY
CREATE TABLE CATEGORY AS SELECT DISTINCT
    PROGRAM_CATEGORY,
    PROGRAM_CATEGORY_DESCRIPTION
FROM
    FoodInspections;
ALTER TABLE CATEGORY
    ADD PRIMARY KEY (PROGRAM_CATEGORY);

-- ACTION
CREATE TABLE ACTION AS SELECT DISTINCT
    ACTION_CODE,
    ACTION_DESC
FROM
    FoodInspections;
ALTER TABLE ACTION
    ADD PRIMARY KEY (ACTION_CODE);

-- RESULT
CREATE TABLE RESULT AS SELECT DISTINCT
    RESULT_CODE,
    RESULT_DESC
FROM
    FoodInspections;
ALTER TABLE RESULT
    ADD PRIMARY KEY (RESULT_CODE);

-- VIOLATION
CREATE TABLE VIOLATION AS SELECT DISTINCT
    VIOLATION_CODE,
    VIOLATION_DESC
FROM
    FoodInspections;
ALTER TABLE VIOLATION
    ADD PRIMARY KEY (VIOLATION_CODE);

-- OWNER
CREATE TABLE OWNER AS SELECT DISTINCT
    OWNER_KEY,
    OWNER_NAME
FROM
    FoodInspections;
ALTER TABLE OWNER
    ADD PRIMARY KEY (OWNER_KEY);

-- ADDRESS
CREATE TABLE ADDRESS AS SELECT DISTINCT
    STREET_NUMBER,
    STREET_NAME,
    STREET_TYPE,
    POST_DIRECTIONAL,
    CITY,
    STATE,
    ZIP
FROM
    FoodInspections;
ALTER TABLE ADDRESS
    ADD ADDRESS_ID int PRIMARY KEY NOT NULL AUTO_INCREMENT FIRST;

-- FACILITY
CREATE TABLE FACILITY AS SELECT DISTINCT
    FACILITY_KEY,
    OWNER_KEY,
    ADDRESS_ID,
    NATURE_OF_BUSINESS,
    PHONE
FROM
    FoodInspections f JOIN ADDRESS a ON
        f.STREET_NUMBER = a.STREET_NUMBER AND
        f.STREET_NAME = a.STREET_NAME AND
        f.STREET_TYPE = a.STREET_TYPE AND
        f.POST_DIRECTIONAL = a.POST_DIRECTIONAL AND
        f.CITY = a.CITY AND
        f.STATE = a.STATE AND
        f.ZIP = a.ZIP;
ALTER TABLE FACILITY
    ADD PRIMARY KEY (FACILITY_KEY),
    ADD FOREIGN KEY (OWNER_KEY) REFERENCES OWNER(OWNER_KEY),
    ADD FOREIGN KEY (ADDRESS_ID) REFERENCES ADDRESS(ADDRESS_ID);

-- INSPECTION
CREATE TABLE INSPECTION AS SELECT DISTINCT
    SERIAL_NUM,
    FACILITY_KEY,
    PROGRAM_CATEGORY,
    INSPECTION_DATE,
    INSPECTION_TYPE,
    INSPECTION_DESC,
    ACTION_CODE,
    RESULT_CODE
FROM
    FoodInspections;
ALTER TABLE INSPECTION
    ADD PRIMARY KEY (SERIAL_NUM),
    ADD FOREIGN KEY (FACILITY_KEY) REFERENCES FACILITY(FACILITY_KEY),
    ADD FOREIGN KEY (PROGRAM_CATEGORY) REFERENCES CATEGORY(PROGRAM_CATEGORY),
    ADD FOREIGN KEY (ACTION_CODE) REFERENCES ACTION(ACTION_CODE),
    ADD FOREIGN KEY (RESULT_CODE) REFERENCES RESULT(RESULT_CODE);

-- FINDING
CREATE TABLE FINDING AS SELECT DISTINCT
    SERIAL_NUM,
    VIOLATION_CODE,
    INSPECTION_MEMO
FROM
    FoodInspections;
ALTER TABLE FINDING
    ADD PRIMARY KEY (SERIAL_NUM, VIOLATION_CODE),
    ADD FOREIGN KEY (SERIAL_NUM) REFERENCES INSPECTION(SERIAL_NUM),
    ADD FOREIGN KEY (VIOLATION_CODE) REFERENCES VIOLATION(VIOLATION_CODE);